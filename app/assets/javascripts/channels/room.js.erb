<% Room.all.each do |room| %>
  App['room' + <%=room.id%>] = App.cable.subscriptions.create({channel: 'RoomChannel', room: <%=room.id%>}, {  
  received: function(data) {
  $("[data-room='" + this.roomid + "']").append(data.message);
  },

  setRoomid: function(roomid) {
    this.roomid = roomid
  }
});
<% end %>

$(document).on('keydown', function(event) {
  if (event.keyCode == 13) {
      var msg = event.target.value
      var roomid = $("[data-room]").data().room
      App['room' + roomid].setRoomid(roomid)
      App['room' + roomid].send({message: msg, room_id: roomid})
      $('[data-input="message"]').val("")
      return false;
  }
});


